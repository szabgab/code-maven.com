---
title: "Multiple OS-es using Rexify"
timestamp: 2021-03-22T18:00:01
tags:
  - Rex
types:
  - screencast
published: true
archive: true
show_related: true
---


During this meeting [Ferenc Erki](https://www.linkedin.com/in/ferki/), the lead developer of [Rex](https://www.rexify.org/)
helped us with various tasks using Rex.

We started where we left of last time when FErki gave us an [introduction to Rex](/automation-with-rex).


{% youtube id="RijvRBdLw5Y" file="rex-2_1920x1080.mp4" %}

## Before the meeting

I've created a Rexfile to set up the environment as we had it when we finished the first session.
* Created a pair of private/public keys that will be used in these examples. Locally I saved them in <b>~/.ssh/rex</b>. I have manually uploaded the public key to Digital Ocean and call it Rex.
* Create A Droplet with Ubuntu 20.04 in New York 1.  Hostname code-maven-rex. This will me the management machine during the meeting.
* Also create 2 Droplets with Ubuntu 20.04 in New York 1 Hostname ubu-1 and ubu-2 using the Rex public key
* On the management server: Install Rex using apt-get, copy the .ssh/config file and copy the files we created in the [previous session](/automation-with-rex)
* Copy the private ssh key to ~/.ssh/ on code-maven-rex, the management machine.
* Run the Rex code on the management server to set up the web server on ubu-1

{% include file="examples/rex/setup/Rexfile" %}

I had to update the config file manually based on the IP addresses generated by Digital Ocean.

{% include file="examples/rex/setup/files/config" %}


* [Get Rex](https://www.rexify.org/get/index.html)
* [template](https://metacpan.org/pod/Rex::Commands::File#template($file,-@params))
* [get_operating_system](https://metacpan.org/pod/Rex::Commands::Gather#get_operating_system)
* [case](https://metacpan.org/pod/Rex::Commands#case)
* [paralellism](https://metacpan.org/pod/Rex::Commands#parallelism($count))
* [install_packages](https://metacpan.org/pod/Rex::Commands::Pkg#installed_packages)
* [local::lib](https://metacpan.org/pod/local::lib)
* [reboot_and_wait.rex.pl](https://gist.github.com/krimdomu/335d01fc0f1e28f2bb7929eaf552eb93)
* [patch system and reboot gist (long)](https://gist.github.com/krimdomu/46efdc68b4067e9b792c)

## Tasks
* Switch to latest Rex from CPAN.
* Create droplets using Fedora, Debian, CentOS, and FreeBSD as well in different regions. (Done manually during the meeting.)
* Deploy the Web server with our page on each one of them. (Managed to do it partially)
* Introduction to templates - Change the html page so on each distribution it will say "Welcome to DISTRIBUTION by Rex"
* We discussed a way to version control exactly what we are running? (So list inventory and only allow to run on the macnies in the inventory. host groups?)

Added the following to <b>~/.bashrc</b>, disconnected and logged in again.

```
eval "$(perl -I$HOME/perl5/lib/perl5 -Mlocal::lib)"
```


## Bash history

{% include file="examples/rex/round2/history.txt" %}

## Rexfile

{% include file="examples/rex/round2/Rexfile" %}

## HTML Template

{% include file="examples/rex/round2/files/main.html" %}

## Nginx config file

{% include file="examples/rex/round2/files/ubu-1.conf" %}

## .ssh/config file

{% include file="examples/rex/round2/config" %}

<!--
Before the meeting create a script that will set up the environment as we had it when we finished the first session.
* Create a pair of private/public keys that will be used in these examples. Upload the public key to Digital Ocean
* If not too difficult write a script that will create a new Droplet with my own personal public key. This is going to be the management host.
* Also create 2 machines using the Rex public key called ubu-1 and ubu-2
* On the management server: Install Rex using apt-get, copy the .ssh/config file and copy the files we created in the [previous session](/automation-with-rex)
* Copy the private ssh key to ~/.ssh/
* Run the Rex code on the management server to set up the web server on ubu-1

* Switch to latest Rex from CPAN (perhaps even inside a perlbrew environment?)
* Create droplets using Fedora, Debian, CentOS, and FreeBSD as well in different regions.
* Deploy the Web server with our page on each one of them.
* Introduction to templates - Change the html page so on each distribution it will say "Welcome to DISTRIBUTION by Rex"
* Do we have a way to version control exactly what we are running? (So list inventory and only allow to run on the macnies in the inventory. host groups?)
* Mention the idea of separating code and data (e.g. via CMDB, config files, APIs, etc.)
* Maybe convert the nginx logic from Rexfile into a module (e.g. Rex::CodeMaven::Nginx)
* add a cert to nginx (e.g. via Let's Encrypt)
* Enable basic auth in nginx

-->
